.check_pre_commit_template:
  stage: pre_commit
  image: "$CI_DOCKER_REGISTRY/esp-idf-doc-env-v5.4:1-1"

  script:
    - pip install pre-commit
    - git fetch origin $CI_MERGE_REQUEST_TARGET_BRANCH_NAME --depth=1 
    - git fetch origin $CI_COMMIT_REF_NAME --depth=1
    - |
      echo "Target branch: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME"
      echo "Source branch: $CI_COMMIT_REF_NAME"

      MODIFIED_FILES=$(git diff --name-only origin/$CI_MERGE_REQUEST_TARGET_BRANCH_NAME..origin/$CI_COMMIT_REF_NAME)
      echo "Modified files to check:"
      echo "$MODIFIED_FILES"

      if [ -n "$MODIFIED_FILES" ]; then
          CI=true pre-commit run --files $MODIFIED_FILES
      else
          echo "No modified files to check."
      fi

check_pre_commit:
  extends:
    - .check_pre_commit_template
    - .rules:pre_commit:check_pre_commit
  tags:
    - build_docs